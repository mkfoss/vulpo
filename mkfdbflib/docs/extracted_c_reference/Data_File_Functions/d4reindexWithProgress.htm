<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>d4reindexWithProgress</title>

<!--(Meta)==========================================================-->

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content=ImportDoc>
<meta name=OriginalFile content="C:\Documentation\C Reference Guide Word Docs\data4.doc">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=1218>
<meta name=layout-width content=741>


<!--(Links)=========================================================-->

<link rel="stylesheet" href="data4.css">



</head>

<!--(Body)==========================================================-->


<body lang=EN-US>

<h2>d4reindexWithProgress</h2>

<p class=FunctionDefinition>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Usage:&nbsp;&nbsp;&nbsp; 
 </span></span>short d4reindexWithProgress( DATA4 *data, short(&nbsp;__stdcall&nbsp;*callback&nbsp;)(&nbsp;double&nbsp;), 
 long&nbsp;milliseconds&nbsp;)</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span 
 class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Description:&nbsp;&nbsp;&nbsp; 
 </span></span>All of the index files corresponding to the data file are 
 recreated. This function is equivalent to <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">d4reindex</span></span>, 
 except that <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4reindexWithProgress</span></span> 
 allows you to provide a callback function that receives progress notifications.</p>

<p class=Body
	style="text-indent: 0px;">This function returns immediately. The process 
 of reindexing takes place in a background thread.</p>

<p class=Body
	style="margin-bottom: .0001pt; text-indent: 0px;">It is generally a 
 good idea to open the files exclusively (set <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">CODE4.accessMode </span></span>to 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">OPEN4DENY_RW 
 </span></span>before opening the data file) before reindexing.</p>

<p class=Body
	style="margin-top: 6.0pt; text-indent: 0px;">After the reindex completes, 
 the contents of the record buffer and the record number are undefined. 
 Explicitly call a positioning function such as <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">d4top</span></span> to 
 position to a desired record.</p>

<!--(Table)=========================================================-->
<table x-use-null-cells
		style="margin-left: 5.4pt;
				border-collapse: collapse;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0>

<tr>
<td style="x-cell-content-align: top;
			width: 85.5pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;"
	valign=top
	width=85.5pt>
<p class=Body
	style="margin: 0in;
			margin-bottom: .0001pt;
			text-indent: 0in;
			font-size: 16.0pt;
			font-family: Arial;"><b style="font-weight: bold;"><sup style="vertical-align: super;"><img src="../Images/Warning.gif" v:shapes="_x0000_i1061" x-maintain-ratio="TRUE" style="width: 91px;
			height: 57px;
			float: none;
			border-style: none;" width="91" height="57" border="0"></sup></b></td>
<td style="x-cell-content-align: top;
			width: 315.9pt;
			border: solid #000000 .75pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;
			background-color: #e5e5e5;"
	bgcolor=#E5E5E5
	valign=top
	width=315.9pt>
<p class=NoteText>Do not call any CodeBase functions until after the reindex 
 has completed. Doing so might corrupt memory. Use <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt;">code4actionCode</span></span> to determine 
 if the reindex has completed or wait for the callback function to be passed 
 1.0.</td></tr>
</table>

<p class=Body
	style="margin-top: 6.0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Parameters:&nbsp;&nbsp;&nbsp; 
 </span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">callback&nbsp;&nbsp;&nbsp; 
 </span></span>A pointer to the callback function. The function must take 
 a <span class=InlineLanguageType><span style="font-size: 10.0pt;">double</span></span> 
 as a parameter, return a <span class=InlineLanguageType><span style="font-size: 10.0pt;">short</span></span>, 
 and use the stdcall calling convention. The parameter will be a value 
 from 0.0 to 1.0 which indicates the progress of the reindex. Any value 
 outside of this range indicates an error. The return value is reserved 
 for future expandability and not currently used.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">waitTime&nbsp;&nbsp;&nbsp; 
 </span></span>The number of milliseconds to wait between calls to the 
 callback function.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Returns:&nbsp;&nbsp;&nbsp; 
 </span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4success&nbsp;&nbsp;&nbsp; 
 </span></span>Success. The reindex will proceed in the background.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&lt; 
 0&nbsp;&nbsp;&nbsp; </span></span>Error.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Locking:&nbsp;&nbsp;&nbsp; 
 </span></span>The data file and corresponding index files are locked. 
 It is recommended that the index files be opened exclusively if a reindex 
 is to occur. This will ensure that other users cannot access the file 
 while it is being reindexed. Applications that access index files that 
 have not been fully reindexed may generate errors or obtain incorrect 
 database information.</p>

<p class=Body><span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 Client-Server:&nbsp;&nbsp;&nbsp; </span></span>Polling the server for 
 reindex progress requires an additional connection to the server. If the 
 server has reached its maximum number of connections, CodeBase will fail 
 to establish this connection. If this happens, CodeBase will pass the 
 appropriate error code to the callback function. Then CodeBase will pass 
 0.0 to the callback function at <i>waitTime</i> millisecond intervals 
 until the reindex has completed.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle
		style="font-size: 9.0pt; font-family: Arial;">See Also:</span>&nbsp;&nbsp; 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="../Code4/CodeBase_Function_Reference/code4actionCode.htm">code4actionCode</a></span></p>

<p class=SourceCode>/*ex131.c*/</p>

<p class=SourceCode>#include &lt;d4all.h&gt;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>int reindexDone;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>short __stdcall cback(double p)</p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; printf(&quot;%f\n&quot;,p);</p>

<p class=SourceCode>&nbsp;&nbsp; if (p &gt;= 1.0)</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; reindexDone = 1;</p>

<p class=SourceCode>&nbsp;&nbsp; return 0;</p>

<p class=SourceCode>}</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>int main(void)</p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; CODE4 cb;</p>

<p class=SourceCode>&nbsp;&nbsp; DATA4 *data;</p>

<p class=SourceCode>&nbsp;&nbsp; unsigned short actionCode;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4init(&amp;cb);</p>

<p class=SourceCode>&nbsp;&nbsp; data = d4open(&amp;cb,&quot;student&quot;);</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; reindexDone = 0;</p>

<p class=SourceCode>&nbsp;&nbsp; d4reindexWithProgress(data,cback,200);</p>

<p class=SourceCode>&nbsp;&nbsp; while (!reindexDone)</p>

<p class=SourceCode>&nbsp;&nbsp; {</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; Sleep(0);</p>

<p class=SourceCode>&nbsp;&nbsp; }</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; Sleep(210);&nbsp; /* Make sure example 
 does not exit before final callback. */</p>

<p class=SourceCode>&nbsp;&nbsp; return code4initUndo(&amp;cb);</p>

<p class=SourceCode>}</p>

</body>

</html>
