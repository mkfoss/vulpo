<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>d4optimizeWrite</title>

<!--(Meta)==========================================================-->

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content=ImportDoc>
<meta name=OriginalFile content="C:\Documentation\C Reference Guide Word Docs\data4.doc">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=1219>
<meta name=layout-width content=741>


<!--(Links)=========================================================-->

<link rel="stylesheet" href="data4.css">



</head>

<!--(Body)==========================================================-->


<body lang=EN-US>

<h2>d4optimizeWrite</h2>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Usage:&nbsp;&nbsp;&nbsp; 
 </span></span>int d4optimizeWrite( DATA4 *data, int optFlag )&nbsp;</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span 
 class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Description:&nbsp;&nbsp;&nbsp; 
 </span></span>This function sets the memory write optimization strategy 
 for the data file and corresponding memo and index files. </p>

<p class=Body
	style="text-indent: 0px;">Memory optimization does not actually take 
 place until <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">code4optStart</span></span> 
 has been called. If <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">code4optStart</span></span> 
 has already been called, the file's memory optimizations are effective 
 immediately once it is flagged as a memory optimized file.</p>

<p class=Body
	style="text-indent: 0px;">The initial write optimization strategy is 
 set when the file is opened, according to the value in flag <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">CODE4.optimizeWrite</span></span>. 
 If write optimization is turned on, then memory optimization, as defined 
 by the <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">CODE4.optimize</span></span> 
 switch, is also turned on. </p>

<!--(Table)=========================================================-->
<table x-use-null-cells
		style="margin-left: 5.4pt;
				border-collapse: collapse;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0>

<tr>
<td style="x-cell-content-align: top;
			width: 85.5pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;"
	valign=top
	width=85.5pt>
<p class=Body
	style="margin-left: 0in;
			text-indent: 0in;
			font-size: 16.0pt;
			font-family: Arial;"><b style="font-weight: bold;"><sup style="vertical-align: super;"><img src="../Images/Warning.gif" v:shapes="_x0000_i1057" x-maintain-ratio="TRUE" style="width: 91px;
			height: 57px;
			float: none;
			border-style: none;" width="91" height="57" border="0"></sup></b></td>
<td style="x-cell-content-align: top;
			width: 315.9pt;
			border: solid #000000 .75pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;
			background-color: #e5e5e5;"
	bgcolor=#E5E5E5
	valign=top
	width=315.9pt>
<p class=NoteText>Use write optimization on shared files with extreme care, 
 because write optimized files can return inconsistent data, since parts 
 of a file may not be updated immediately due to the optimization procedures. 
 For shared files, write optimization never actually takes place until 
 the file is locked.</p>
<p class=NoteText
	style="margin-top: 6.0pt;">Write optimization does not improve performance 
 unless the entire data file is locked over a number of operations. Write 
 optimization would improve performance, for example, when appending many 
 records at once.</td></tr>
</table>

<p class=Body
	style="margin-top: 6.0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Parameters:&nbsp;&nbsp;&nbsp; 
 </span></span>The possible values for optFlag are: </p>

<p class=Body
	style="margin-left: 2.25in; text-indent: -99.0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">OPT4EXCLUSIVE&nbsp;&nbsp;&nbsp; 
 </span></span>Write-optimize when files are opened exclusively or when 
 the <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">S4OFF_MULTI</span></span><span 
 class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">&nbsp;</span></span>compilation 
 switch is defined. Otherwise, do not write optimize. This is the default 
 value when <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4optimizeWrite</span></span> 
 is not called. </p>

<p class=Body
	style="margin-left: 2.25in; text-indent: -99.0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">OPT4OFF&nbsp;&nbsp;&nbsp; 
 </span></span>Never write optimize. </p>

<p class=Body
	style="margin-left: 2.25in; text-indent: -99.0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">OPT4ALL&nbsp;&nbsp;&nbsp; 
 </span></span>This is the same as the <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">OPT4EXCLUSIVE</span></span> 
 option except shared files, which are locked, are also write optimized. 
 Use this option with care. If concurrently running applications do not 
 lock, they may be presented with inconsistent data. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Returns:</span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4success&nbsp;&nbsp;&nbsp; 
 </span></span>Success.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&lt; 
 0&nbsp;&nbsp;&nbsp; </span></span>An error occurred. </p>

<p class=Body><span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 Client-Server:</span></span>&nbsp;&nbsp; In the client-server configuration, 
 the optimization is controlled at the server level, so the function <span 
 class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4optimizeWrite</span></span> 
 always returns success.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle
		style="font-size: 9.0pt; font-family: Arial;">See Also</span>:&nbsp;&nbsp; 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="../File_Functions/file4optimizeWrite.htm">file4optimizeWrite</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="d4optimize.htm">d4optimize</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="../Code4/CODE4_Structure_Variables/CODE4.optimizeWrite.htm">CODE4.optimizeWrite</a></span></p>

<p class=SourceCode>/*ex54.c*/</p>

<p class=SourceCode>#include &quot;d4all.h&quot; </p>

<p class=SourceCode>extern unsigned _stklen = 10000 ; /* for all Borland 
 compilers*/ </p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>void main( void ) </p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; CODE4 cb ;</p>

<p class=SourceCode>&nbsp;&nbsp; DATA4 *data ;</p>

<p class=SourceCode>&nbsp;&nbsp; FIELD4 *ageField ;</p>

<p class=SourceCode>&nbsp;&nbsp; long age ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4init( &amp;cb ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; data = d4open( &amp;cb, &quot;INFO&quot; 
 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; d4optimizeWrite( data, OPT4ALL ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; /* when doing write optimization on shared 
 files, it is necessary to</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 lock the file, preferably with d4lockAll( ) */</p>

<p class=SourceCode>&nbsp;&nbsp; d4lockAll( data ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4optStart( &amp;cb ) ; /* begin optimization 
 */</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; age = 20 ;</p>

<p class=SourceCode>&nbsp;&nbsp; ageField = d4field( data, &quot;AGE&quot;) 
 ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; /* append a copies of the first record, 
 assigning the age field's</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; value from 20 
 to 65*/</p>

<p class=SourceCode>&nbsp;&nbsp; for( d4top( data ) ; age &lt; 65 ; d4append( 
 data ) )</p>

<p class=SourceCode>&nbsp;&nbsp; {</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d4appendStart( 
 data, 0 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; f4assignLong( 
 ageField, age++ ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; }</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4initUndo( &amp;cb ) ; /* flushes, 
 closes, and unlocks */</p>

<p class=SourceCode>}</p>

</body>

</html>
