<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>d4memoCompress</title>

<!--(Meta)==========================================================-->

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content=ImportDoc>
<meta name=OriginalFile content="C:\Documentation\C Reference Guide Word Docs\data4.doc">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=1119>
<meta name=layout-width content=741>


<!--(Links)=========================================================-->

<link rel="stylesheet" href="data4.css">



</head>

<!--(Body)==========================================================-->


<body lang=EN-US>

<h2>d4memoCompress</h2>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Usage:&nbsp;&nbsp;&nbsp; 
 </span></span>int d4memoCompress( DATA4 *data )&nbsp;</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span 
 class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Description:&nbsp;&nbsp;&nbsp; 
 </span></span>The memo file corresponding to the data file is compressed. 
 If the data file has no memo file, nothing happens. </p>

<p class=Body
	style="text-indent: 0px;">A call to <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">d4memoCompress</span></span> 
 may be desirable after packing or zapping a data file. This is because 
 these functions do not remove memo entries. The unreferenced memo entries 
 do no harm except waste disk space.&nbsp;When memo files entries are reduced 
 in size, the disk space previously occupied by the entries becomes available 
 for reuse by the memo file. However, the disk space is not necessarily 
 returned to the operating system. This function compresses the memo file 
 to return the disk space to the operating system. </p>

<p class=Body
	style="text-indent: 0px;"><span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4memoCompress</span></span> 
 first makes a temporary memo file in the current directory with the same 
 name as the original memo file but with a &quot;<b>.TMP</b>&quot; extension. 
 The original memo file is then compressed into this file. Finally, when 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">S4OFF_MULTI</span></span><span 
 class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">&nbsp;</span></span>is 
 defined, the original memo file is deleted and the newly created memo 
 file is renamed to the original name. However, in the multi-user case, 
 the contents of the new memo file are copied back into the original file, 
 the file size is shrunk, and the temporary file is deleted. </p>

<!--(Table)=========================================================-->
<table x-use-null-cells
		style="margin-left: 5.4pt;
				border-collapse: collapse;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0>

<tr>
<td style="x-cell-content-align: top;
			width: 85.5pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;"
	valign=top
	width=85.5pt>
<p class=Body
	style="margin-left: 0in;
			text-indent: 0in;
			font-size: 16.0pt;
			font-family: Arial;"><b style="font-weight: bold;"><sup style="vertical-align: super;"><img src="../Images/Warning.gif" v:shapes="_x0000_i1050" x-maintain-ratio="TRUE" style="width: 91px;
			height: 57px;
			float: none;
			border-style: none;" width="91" height="57" border="0"></sup></b></td>
<td style="x-cell-content-align: top;
			width: 310.5pt;
			border: solid #000000 .75pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;
			background-color: #e5e5e5;"
	bgcolor=#E5E5E5
	valign=top
	width=310.5pt>
<p class=NoteText>Appropriate backup measures should be taken before calling 
 this function. It does not make a permanent backup file. However<span 
 style="font-size: 12.0pt; font-family: 'Times New Roman';">,</span> if 
 the function fails for whatever reason<span style="font-size: 12.0pt; font-family: 'Times New Roman';">,</span> 
 either the original memo file or the temporary file<span style="font-size: 12.0pt; font-family: 'Times New Roman';">,</span> 
 containing the newly compressed memo file contents<span style="font-size: 12.0pt; font-family: 'Times New Roman';">,</span> 
 should be present. </td></tr>
</table>

<p class=Body
	style="margin-top: 6.0pt; text-indent: 0px;">It is recommended that 
 data files be opened exclusively (i.e. setting <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">CODE4.accessMode</span></span> 
 to <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">OPEN4DENY_RW</span></span> 
 before opening the datafile) before the memos are compressed. This ensures 
 that other users cannot access the memo file while it is being compressed. 
 Applications that access memo files that have not fully been compressed 
 may generate errors or read random data. </p>

<!--(Table)=========================================================-->
<table x-use-null-cells
		style="margin-left: 5.4pt;
				border-collapse: collapse;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0>

<tr>
<td style="x-cell-content-align: top;
			width: 85.5pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;"
	valign=top
	width=85.5pt>
<p class=Body
	style="margin: 0in;
			margin-bottom: .0001pt;
			text-indent: 0in;"><img src="../Images/Warning.gif" v:shapes="_x0000_i1051" x-maintain-ratio="TRUE" style="width: 91px;
											height: 57px;
											float: none;
											border-style: none;" width="91" height="57" border="0"></td>
<td style="x-cell-content-align: top;
			width: 310.5pt;
			border: solid #000000 .75pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;
			background-color: #e5e5e5;"
	bgcolor=#E5E5E5
	valign=top
	width=310.5pt>
<p class=NoteText>This function may not be used to compress a memo file 
 while a transaction is in progress. Attempts to do so will fail and generate 
 an <span class=InlineFunctionNames><span style="font-size: 10.0pt;">e4transViolation 
 </span></span>error.</td></tr>
</table>

<p class=Body
	style="margin-top: 6.0pt;"><span class=InlineFunctionDescTitle><span 
 style="font-size: 9.0pt; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 Returns:</span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4success&nbsp;&nbsp;&nbsp; 
 </span></span>Success. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4locked&nbsp;&nbsp;&nbsp; 
 </span></span>The data file is already locked by another user. </p>

<p class=Body><span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 r4unique&nbsp;&nbsp;&nbsp; </span></span>This value is returned when a 
 record flush causes a duplicate key in a unique tag, and <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">t4unique</span></span> 
 returned <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">r4unique</span></span> 
 for the tag.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&lt; 
 0&nbsp;&nbsp;&nbsp; </span></span>Error. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Locking:&nbsp;&nbsp;&nbsp; 
 </span></span>The data file and corresponding memo file must be locked 
 before the memo file can be compressed. See <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">code4unlockAuto</span></span> 
 for details on how any necessary locking and unlocking is accomplished.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle
		style="font-size: 9.0pt; font-family: Arial;">See Also:</span>&nbsp;&nbsp; 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="d4pack.htm">d4pack</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="d4zap.htm">d4zap</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../Code4/CODE4_Structure_Variables/CODE4.accessMode.htm">CODE4.accessMode</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../Code4/CodeBase_Function_Reference/code4unlockAuto.htm">code4unlockAuto</a></span></p>

<p class=SourceCode>/*ex50.c*/</p>

<p class=SourceCode>#include &quot;d4all.h&quot;</p>

<p class=SourceCode>void compressAll( DATA4 *d ) </p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; if( d4pack( d ) == r4success )</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf( &quot;Records 
 marked for deletion are removed\n&quot; ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; if( d4memoCompress( d ) == r4success )</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf( &quot;Memo 
 entries are compressed\n&quot;) ;</p>

<p class=SourceCode>}</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>void main ()</p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; CODE4 cb ;</p>

<p class=SourceCode>&nbsp;&nbsp; DATA4 *data ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4init( &amp;cb ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; data = d4open( &amp;cb, &quot;DATA&quot; 
 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; compressAll( data ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; code4initUndo( &amp;cb ) ;</p>

<p class=SourceCode>}</p>

</body>

</html>
