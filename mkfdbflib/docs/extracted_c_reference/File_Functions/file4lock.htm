<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>file4lock</title>

<!--(Meta)==========================================================-->

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content=ImportDoc>
<meta name=OriginalFile content="C:\Documentation\C Reference Guide Word Docs\file4.doc">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=935>
<meta name=layout-width content=741>


<!--(Links)=========================================================-->

<link rel="stylesheet" href="file4.css">



</head>

<!--(Body)==========================================================-->


<body lang=EN-US>

<div style="border: none;
			border-bottom: solid #000000 2.25pt;
			padding: 0in 0in 1.0pt 0in;">
<h2>file4lock</h2>
</div>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Usage:&nbsp;&nbsp;&nbsp; 
 </span></span>int file4lock( FILE4 *file, long posStart, long numBytes 
 )&nbsp;</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span 
 class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Description:&nbsp;&nbsp;&nbsp; 
 </span></span>The specified byte range is locked. Depending on the setting 
 of <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">CODE4.lockAttempts</span></span>, 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">file4lock</span></span> 
 tries to lock once, several times, or even keeps trying until it succeeds. 
 </p>

<p class=Body
	style="text-indent: 0px;">In multi-user applications, a portion of 
 the file or the entire file should be locked before any call to <span 
 class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">file4write</span></span>. 
 If the portion of the file being written to is not locked, other applications 
 reading the file may get corrupted data.</p>

<p class=Body
	style="text-indent: 0px;">If write optimizations are being used in 
 multi-user applications with the file functions, it is strongly suggested 
 that the entire file be locked prior to calling <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">file4optimizeWrite</span></span> 
 and <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">file4write</span></span>. 
 In addition, the file should not be unlocked until <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">file4optimizeWrite</span></span> 
 is called to disable write optimizations. </p>

<!--(Table)=========================================================-->
<table x-use-null-cells
		style="margin-left: 5.4pt;
				border-collapse: collapse;
				border-spacing: 0px;
				border-spacing: 0px;"
		cellspacing=0>

<tr>
<td style="x-cell-content-align: top;
			width: 85.5pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;"
	valign=top
	width=85.5pt>
<p class=Body
	style="margin-left: 0in; text-indent: 0in;"><img src="../Images/Note.gif" v:shapes="_x0000_i1028" x-maintain-ratio="TRUE" style="width: 47px;
															height: 40px;
															float: none;
															border-style: none;" width="47" height="40" border="0">&nbsp;<b><sup><span 
 style="font-size: 16.0pt; font-family: Arial;">Note</span></sup></b></td>
<td style="x-cell-content-align: top;
			width: 310.5pt;
			border: solid #000000 .75pt;
			padding: 0in 5.4pt 0in 5.4pt;
			padding-left: 0px;
			padding-top: 0px;
			padding-right: 0px;
			padding-bottom: 0px;
			background-color: #e5e5e5;"
	bgcolor=#E5E5E5
	valign=top
	width=310.5pt>
<p class=NoteText>If the file was opened with the <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt;">CODE4.accessMode</span></span> set to either 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt;">OPEN4DENY_RW</span></span> 
 or <span class=InlineFunctionNames><span style="font-size: 10.0pt;">OPEN4DENY_WRITE</span></span> 
 or if the file's read only attribute is set, <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt;">file4lock</span></span> returns <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt;">r4success</span></span> but actually does nothing. 
 This function also returns <span class=InlineFunctionNames><span style="font-size: 10.0pt;">r4success</span></span> 
 and does nothing if the application was compiled with the <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt;">S4OFF_MULTI</span></span>&nbsp;switch.</td></tr>
</table>

<p class=Body
	style="margin-top: 6.0pt;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Parameters:</span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">posStart&nbsp;&nbsp;&nbsp; 
 </span></span>A byte offset within the file. For example, 0L represents 
 the first byte of the file. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">numBytes&nbsp;&nbsp;&nbsp; 
 </span></span>The number of bytes to lock. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Returns:</span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4success&nbsp;&nbsp;&nbsp; 
 </span></span>Success. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4locked&nbsp;&nbsp;&nbsp; 
 </span></span>The bytes were not locked since they were locked by another 
 user. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&lt; 
 0&nbsp;&nbsp;&nbsp; </span></span>Error. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle
		style="font-size: 9.0pt; font-family: Arial;">See Also:</span>&nbsp;&nbsp; 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="file4unlock.htm">file4unlock</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="file4optimizeWrite.htm">file4optimizeWrite</a></span></p>

<p class=SourceCode>/*ex108.c*/</p>

<p class=SourceCode>#include &quot;d4all.h&quot; </p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>void main( void ) </p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; CODE4 cb ;</p>

<p class=SourceCode>&nbsp;&nbsp; FILE4 test ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4init( &amp;cb ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; if( file4open( &amp;test, &amp;cb, &quot;TEST.FIL&quot;, 
 0 ) &lt; 0 )</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; code4exit( &amp;cb 
 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; cb.lockAttempts = 20 ; /* attempt a lock 
 20 times*/</p>

<p class=SourceCode>&nbsp;&nbsp; if( file4lock( &amp;test, 0, LONG_MAX 
 ) != 0 )</p>

<p class=SourceCode>&nbsp;&nbsp; {</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf( &quot;Unable 
 to lock the file\n&quot; ) ;</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; file4close( &amp;test 
 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; code4initUndo( 
 &amp;cb ) ;</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; code4exit( &amp;cb 
 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; }</p>

<p class=SourceCode>&nbsp;&nbsp; /* double the file size for fun */</p>

<p class=SourceCode>&nbsp;&nbsp; file4lenSet( &amp;test, file4len( &amp;test 
 ) * 2 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; printf( &quot;the new length of the file 
 is %ld&quot;, file4len( &amp;test ) ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; file4close( &amp;test ) ; /* file4close 
 automatically unlocks the file*/</p>

<p class=SourceCode>&nbsp;&nbsp; code4initUndo( &amp;cb ) ;</p>

<p class=SourceCode>}</p>

</body>

</html>
