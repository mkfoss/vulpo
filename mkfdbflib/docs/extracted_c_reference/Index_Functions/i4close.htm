<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>i4close</title>

<!--(Meta)==========================================================-->

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content=ImportDoc>
<meta name=OriginalFile content="C:\Documentation\C Reference Guide Word Docs\index4.doc">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=926>
<meta name=layout-width content=741>


<!--(Links)=========================================================-->

<link rel="stylesheet" href="index4.css">



</head>

<!--(Body)==========================================================-->


<body lang=EN-US>

<h2>i4close</h2>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Usage:&nbsp;&nbsp;&nbsp; 
 </span></span>int i4close( INDEX4 *index&nbsp;) </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span 
 class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Description:&nbsp;&nbsp;&nbsp; 
 </span></span>Only index files opened by <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">i4open</span></span> may 
 be closed by <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">i4close</span></span>. 
 If a production index is opened with <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">d4open</span></span>, <span 
 class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4close</span></span> 
 must be used to close the index file. The index file is flushed to disk 
 if necessary, and then closed. If the record buffer of the corresponding 
 data file has been changed, the record is flushed to disk and the index 
 file is updated before it is closed.</p>

<p class=Body
	style="margin-left: 120px; text-indent: 0px;">If the index must be 
 updated, <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">i4close</span></span> 
 locks the file, performs the flushing, and then closes the file. <span 
 class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">i4close</span></span> 
 temporarily sets the <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">CODE4.lockAttempts 
 </span></span>flag to <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">WAIT4EVER</span></span> 
 to ensure the index file is locked and updated before returning. As a 
 result, <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">i4close</span></span> 
 never returns <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">r4locked</span></span>. 
 If <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">i4close</span></span> 
 encounters a non-unique key in a unique index tag while flushing the data 
 file, the index file is closed, but not updated. </p>

<p class=Body
	style="text-indent: 0px;">An error will be generated if <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">i4close</span></span> is 
 called during a transaction.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Returns:</span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4success&nbsp;&nbsp;&nbsp; 
 </span></span>Success. </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&lt; 
 0&nbsp;&nbsp;&nbsp; </span></span>Error.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Locking:&nbsp;&nbsp;&nbsp; 
 </span></span>If flushing is required, the index file is locked. When 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">i4close</span></span> 
 returns, the file is closed and all locks on the index file are removed. 
 </p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle
		style="font-size: 9.0pt; font-family: Arial;">See Also:</span>&nbsp;&nbsp; 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="../Data_File_Functions/d4close.htm">d4close</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="../Code4/CodeBase_Function_Reference/code4close.htm">code4close</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="i4open.htm">i4open</a></span>, 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="../Code4/CodeBase_Function_Reference/code4tranStart.htm">code4tranStart</a></span></p>

<p class=SourceCode>/*ex118.c*/</p>

<p class=SourceCode>#include &quot;d4all.h&quot; </p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>int addLotsOfRecords( DATA4 *d ) </p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; INDEX4 *production ;</p>

<p class=SourceCode>&nbsp;&nbsp; int i ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; production = d4index( d, d4alias( d ) 
 ) ; /* get the production index file*/</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; if( production != NULL )</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; i4close( production 
 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; d4top( d ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; for( i = 200 ; i ; i -- )</p>

<p class=SourceCode>&nbsp;&nbsp; {</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d4appendStart( 
 d, 0 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d4append( d ) 
 ; /* make 200 copies of record 1*/</p>

<p class=SourceCode>&nbsp;&nbsp; }</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; /* open the index file and update it*/</p>

<p class=SourceCode>&nbsp;&nbsp; production = i4open( d, d4alias( d ) ) 
 ;</p>

<p class=SourceCode>&nbsp;&nbsp; return i4reindex( production ) ;</p>

<p class=SourceCode>}</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>void main()</p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; CODE4 cb ;</p>

<p class=SourceCode>&nbsp;&nbsp; DATA4 *data ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4init( &amp;cb ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; data = d4open( &amp;cb, &quot;DATA&quot;) 
 ;</p>

<p class=SourceCode>&nbsp;&nbsp; addLotsOfRecords( data ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; code4initUndo( &amp;cb ) ;</p>

<p class=SourceCode>}</p>

</body>

</html>
