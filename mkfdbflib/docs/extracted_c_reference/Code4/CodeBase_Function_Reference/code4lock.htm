<!doctype HTML public "-//W3C//DTD HTML 4.0 Frameset//EN">

<html>

<!--(==============================================================)-->
<!--(Document created with RoboEditor. )============================-->
<!--(==============================================================)-->

<head>

<title>code4lock</title>

<!--(Meta)==========================================================-->

<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Originator content=ImportDoc>
<meta name=OriginalFile content="C:\Documentation\C Reference Guide Word Docs\code4.doc">
<meta name=generator content="RoboHELP by eHelp Corporation - www.ehelp.com">
<meta name=generator-major-version content=0.1>
<meta name=generator-minor-version content=1>
<meta name=filetype content=kadov>
<meta name=filetype-version content=1>
<meta name=page-count content=1>
<meta name=layout-height content=1019>
<meta name=layout-width content=753>


<!--(Links)=========================================================-->

<link rel="stylesheet" href="../code4.css">



<!--(Style Sheet)===================================================-->

<style>
<!--

A:visited {
	color: #800080;
}

A:link {
	color: #0000ff;
}

-->
</style>


</head>

<!--(Body)==========================================================-->


<body lang=EN-US>

<h2>code4lock</h2>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Usage:&nbsp;&nbsp;&nbsp; 
 </span></span>int code4lock( CODE4 *codebase )</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <span 
 class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Description:&nbsp;&nbsp;&nbsp; 
 </span></span>This function performs a lock of a group of records, files, 
 and/or append bytes. A group lock functions as if it were a single lock 
 on a single record, however many interdependent records and files, etc. 
 may be locked.</p>

<p class=Body
	style="text-indent: 0px;">The entire lock group is either in a state 
 of having all locks held, or no locks held. If any of the locks fail, 
 all successful locks are removed and an error is returned. That is, if 
 all of the locks were successfully performed, but the last lock failed, 
 all of the successful locks would be removed and <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">code4lock </span></span>would 
 report <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">r4locked</span></span>.</p>

<p class=Body
	style="text-indent: 0px;">This high-level approach to locking minimizes 
 the possibility of deadlock, while giving maximum flexibility.</p>

<p class=Body
	style="margin-bottom: .0001pt; text-indent: 0px;">The process involved 
 in performing a group lock is as follows:</p>

<p class=BodyBullet
	style="margin-top: 3.0pt;
			margin-right: 0in;
			margin-bottom: .0001pt;
			margin-left: 117.0pt;
			text-indent: -16.55pt;"><span style="font-family: Symbol;">·<span 
 style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 </span></span>Set the <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">CODE4.lockAttempts 
 </span></span>and <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">CODE4.lockAttemptsSingle 
 </span></span>to desired values.</p>

<p class=BodyBullet
	style="margin-top: 3.0pt;
			margin-right: 0in;
			margin-bottom: .0001pt;
			margin-left: 117.0pt;
			text-indent: -16.55pt;"><span style="font-family: Symbol;">·<span 
 style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 </span></span>Queue one or more locks with <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">d4lockAdd</span></span>, 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4lockAddAll</span></span>, 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4lockAddFile</span></span>, 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">d4lockAddAppend 
 </span></span>and/or <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">relate4lockAdd.</span></span></p>

<p class=BodyBullet
	style="margin-top: 3.0pt;
			margin-right: 0in;
			margin-bottom: .0001pt;
			margin-left: 117.0pt;
			text-indent: -16.55pt;"><span style="font-family: Symbol;">·<span 
 style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 </span></span>Clear the queued locks, if desired, with <span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">code4lockClear</span></span> 
 and begin the process again, or</p>

<p class=BodyBullet
	style="margin-top: 3.0pt;
			margin-right: 0in;
			margin-bottom: .0001pt;
			margin-left: 117.0pt;
			text-indent: -16.55pt;"><span style="font-family: Symbol;">·<span 
 style="font: 7.0pt 'Times New Roman';">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 </span></span>Attempt to place the queued locks with a single call to 
 <span class=InlineFunctionNames><span style="font-size: 10.0pt; font-family: Arial;">code4lock</span></span>. 
 The return code from this function indicates whether or not the locks 
 were successful.</p>

<p class=Body
	style="margin-top: 6.0pt; text-indent: 0px;"><span class=InlineFunctionNames><span 
 style="font-size: 10.0pt; font-family: Arial;">code4lock </span></span>automatically 
 clears the queue of locks once the locks are successfully performed.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle><span style="font-size: 9.0pt; font-family: Arial;">Returns:</span></span></p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">r4success</span></span>&nbsp;&nbsp; 
 All locks placed in the queue where successfully performed. The queue 
 of locks is emptied.</p>

<p class=Body><span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 r4locked</span></span>&nbsp;&nbsp; A required lock attempt did not succeed 
 and as a result no locks were placed. The queue of lock entries are maintained 
 for a further attempt.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineCommentText><span style="font-size: 9.0pt; font-family: Arial;">&lt; 
 0</span></span>&nbsp;&nbsp; Error. The queue of lock entries are maintained 
 for a further attempt.</p>

<p class=Body>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 
 <span class=InlineFunctionDescTitle
		style="font-size: 9.0pt; font-family: Arial;">See Also:</span>&nbsp;&nbsp; 
 <span class=InlineFunctionNames
		style="font-size: 10.0pt; font-family: Arial;"><a href="code4unlock.htm">code4unlock</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="code4unlockAuto.htm">code4unlockAuto</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="code4lockUserId.htm">code4lockUserId</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="code4lockNetworkId.htm">code4lockNetworkId</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="code4lockItem.htm">code4lockItem</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="code4lockFileName.htm">code4lockFileName</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../CODE4_Structure_Variables/CODE4.lockAttempts.htm">CODE4.lockAttempts</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../CODE4_Structure_Variables/CODE4.lockAttemptsSingle.htm">CODE4.lockAttemptsSingle</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../../Data_File_Functions/d4lockAdd.htm">d4lockAdd</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../../Data_File_Functions/d4lockAddFile.htm">d4lockAddFile</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../../Data_File_Functions/d4lockAddAppend.htm">d4lockAddAppend</a></span><span 
 class=InlineFunctionNames
	style="font-size: 12.0pt; font-weight: normal;">,</span><span class=InlineFunctionNames
	style="font-size: 10.0pt; font-family: Arial;"> <a href="../../RelateQuery_Module/relate4lockAdd.htm">relate4lockAdd</a></span></p>

<p class=SourceCode>/*ex20.c*/</p>

<p class=SourceCode>#include &quot;d4all.h&quot;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>void main( void )</p>

<p class=SourceCode>{</p>

<p class=SourceCode>&nbsp;&nbsp; CODE4 cb ;</p>

<p class=SourceCode>&nbsp;&nbsp; DATA4 *data1, *data2;</p>

<p class=SourceCode>&nbsp;&nbsp; long numRec;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4init( &amp;cb ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; data1 = d4open( &amp;cb, &quot;DATA1&quot; 
 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; data2 = d4open( &amp;cb, &quot;DATA2&quot; 
 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; d4top( data1 ) ; d4top( data2 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; d4lockAddFile( data1 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; d4lockAddAppend( data2 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; numRec = d4recCount( data2 ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; d4lockAdd( data2, numRec ) ;</p>

<p class=SourceCode>&nbsp;&nbsp; d4lockAdd( data2, numRec-1 ) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; if( code4lock( &amp;cb ) == r4success 
 )</p>

<p class=SourceCode>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; printf( &quot;All 
 locks were successfully performed\n&quot;) ;</p>

<p class=SourceCode>&nbsp;</p>

<p class=SourceCode>&nbsp;&nbsp; code4initUndo( &amp;cb ) ;</p>

<p class=SourceCode>}</p>

</body>

</html>
